<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firebase CRUD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-8 flex flex-wrap gap-4 justify-between items-center">
            <h1 class="text-3xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Users)</h1>
            <div class="flex gap-2">
                <button onclick="switchCollection('Users')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition duration-200">
                    <i class="fas fa-users"></i> Users (‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà)
                </button>
                <button onclick="switchCollection('users')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition duration-200">
                    <i class="fas fa-user"></i> users (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å)
                </button>
                <button onclick="openModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition duration-200">
                    <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>

        <!-- Current Collection Indicator -->
        <div id="collectionIndicator" class="mb-4 p-3 bg-blue-100 text-blue-800 rounded-lg">
            <i class="fas fa-database mr-2"></i>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å: <strong id="currentCollection">users</strong>
        </div>

        <!-- Connection Status -->
        <div id="connectionStatus" class="mb-4 p-3 rounded-lg hidden"></div>

        <!-- Database Structure Viewer -->
        <div class="mb-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
            <h3 class="font-bold text-yellow-800 mb-2 flex items-center">
                <i class="fas fa-sitemap mr-2"></i>‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏û‡∏ö:
            </h3>
            <div id="dbStructure" class="text-sm text-gray-600 font-mono">
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="mb-6 flex flex-wrap gap-4">
            <div class="flex-1 min-w-[200px]">
                <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•..." class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <select id="filterSelect" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="admin">Admin</option>
                <option value="user">User</option>
            </select>
            <button onclick="loadData()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 flex items-center gap-2">
                <i class="fas fa-sync-alt"></i> ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏π‡∏õ</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">UID</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Data will be shown here -->
                </tbody>
            </table>
        </div>

        <!-- Data Count -->
        <div id="dataCount" class="mt-4 text-sm text-gray-600"></div>

        <!-- Modal for Add/Edit -->
        <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-lg bg-white">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold" id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                    <button onclick="closeModal()" class="text-gray-600 hover:text-gray-900">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="dataForm" onsubmit="saveData(event)">
                    <input type="hidden" id="dataId">
                    <input type="hidden" id="dataKey">
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">UID (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="text" id="uid" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô U4e9df252048d7102aa6cf2bd7abd9bdd">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" id="name" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" id="email" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå URL</label>
                        <input type="url" id="photoURL" placeholder="https://example.com/photo.jpg" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
                        <select id="role" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                            <option value="user">User</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    
                    <div class="flex gap-2 justify-end">
                        <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="deleteModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-lg bg-white">
                <h3 class="text-lg font-bold mb-4">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
                <p class="mb-4">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                <div class="flex gap-2 justify-end">
                    <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button onclick="confirmDelete()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">‡∏•‡∏ö</button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden">
            <span id="toastMessage"></span>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAxQr1PCwjWhoz143Ipzcjx9sq2hw5R9dc",
            authDomain: "cm-bookingroom.firebaseapp.com",
            databaseURL: "https://cm-bookingroom-default-rtdb.firebaseio.com",
            projectId: "cm-bookingroom",
            storageBucket: "cm-bookingroom.firebasestorage.app",
            messagingSenderId: "312076484549",
            appId: "1:312076484549:web:d9e1cb3e28747c1aa695ac"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("‚úÖ Firebase initialized successfully");
        } catch (error) {
            console.error("‚ùå Error initializing Firebase:", error);
        }

        const database = firebase.database();
        let currentCollection = 'users'; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà users (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å)
        let currentData = [];
        let deleteId = null;
        let deleteKey = null;

        // Check Firebase Connection
        const connectedRef = database.ref('.info/connected');
        connectedRef.on('value', (snap) => {
            if (snap.val() === true) {
                showConnectionStatus("success", "‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                exploreDatabase();
                loadData();
            } else {
                showConnectionStatus("error", "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÑ‡∏î‡πâ");
            }
        });

        // Explore database structure
        function exploreDatabase() {
            database.ref().once('value', (snapshot) => {
                const data = snapshot.val();
                const structure = document.getElementById('dbStructure');
                
                if (data) {
                    const keys = Object.keys(data);
                    let html = '<div class="space-y-1">';
                    keys.forEach(key => {
                        const itemCount = data[key] ? Object.keys(data[key]).length : 0;
                        html += `<div class="flex items-center gap-2">
                            <i class="fas fa-folder-open text-yellow-500"></i>
                            <span class="font-mono">${key}</span>
                            <span class="text-xs bg-gray-200 px-2 py-0.5 rounded">${itemCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            ${key === 'Users' || key === 'users' ? 
                                '<span class="text-xs bg-green-200 text-green-800 px-2 py-0.5 rounded">‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span>' : 
                                ''}
                        </div>`;
                    });
                    html += '</div>';
                    structure.innerHTML = html;
                } else {
                    structure.innerHTML = '<span class="text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>';
                }
            });
        }

        // Switch between Users and users collection
        function switchCollection(collection) {
            currentCollection = collection;
            document.getElementById('currentCollection').textContent = collection;
            showToast(`‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô: ${collection}`);
            loadData();
        }

        // Show connection status
        function showConnectionStatus(type, message) {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
            
            if (type === "success") {
                statusDiv.classList.add('bg-green-100', 'text-green-700');
            } else {
                statusDiv.classList.add('bg-red-100', 'text-red-700');
            }
            
            statusDiv.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>${message}`;
            statusDiv.classList.remove('hidden');
            
            if (type === "success") {
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 3000);
            }
        }

        // Load data from current collection
        function loadData() {
            console.log(`üîÑ Loading data from ${currentCollection}...`);
            
            const collectionRef = database.ref(currentCollection);
            
            document.getElementById('tableBody').innerHTML = `
                <tr>
                    <td colspan="6" class="px-6 py-8 text-center">
                        <i class="fas fa-circle-notch fa-spin text-3xl text-blue-500 mb-2"></i>
                        <p class="text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ${currentCollection}...</p>
                    </td>
                </tr>
            `;
            
            collectionRef.once('value', (snapshot) => {
                const data = snapshot.val();
                console.log(`üì¶ Data from ${currentCollection}:`, data);
                
                currentData = [];
                
                if (data) {
                    // Handle different data structures
                    if (currentCollection === 'Users') {
                        // Users (‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà) ‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô Uxxxxx: { ... }
                        currentData = Object.keys(data).map(key => ({
                            id: key,
                            key: key,
                            uid: key, // ‡πÉ‡∏ä‡πâ key ‡πÄ‡∏õ‡πá‡∏ô uid
                            ...data[key]
                        }));
                    } else {
                        // users (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å) ‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô -Oxxxx: { ... }
                        currentData = Object.keys(data).map(key => ({
                            id: key,
                            key: key,
                            ...data[key]
                        }));
                    }
                    console.log(`‚úÖ Loaded ${currentData.length} records from ${currentCollection}`);
                } else {
                    console.log(`‚ÑπÔ∏è No data found in ${currentCollection}`);
                }
                
                renderTable();
                updateDataCount();
                
            }, (error) => {
                console.error(`‚ùå Error loading from ${currentCollection}:`, error);
                showToast(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, "error");
                
                document.getElementById('tableBody').innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-8 text-center text-red-500">
                            <i class="fas fa-exclamation-circle text-3xl mb-2"></i>
                            <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ${currentCollection} ‡πÑ‡∏î‡πâ</p>
                            <p class="text-sm mt-2">${error.message}</p>
                            <button onclick="loadData()" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        // Render table
        function renderTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterValue = document.getElementById('filterSelect').value;
            
            let filteredData = [...currentData];
            
            // Apply search filter
            if (searchTerm) {
                filteredData = filteredData.filter(item => 
                    (item.name && item.name.toLowerCase().includes(searchTerm)) ||
                    (item.email && item.email.toLowerCase().includes(searchTerm)) ||
                    (item.uid && item.uid.toLowerCase().includes(searchTerm)) ||
                    (item.displayName && item.displayName.toLowerCase().includes(searchTerm))
                );
            }
            
            // Apply role filter
            if (filterValue !== 'all') {
                filteredData = filteredData.filter(item => 
                    (item.role === filterValue) || 
                    (item.role === filterValue)
                );
            }
            
            const tbody = document.getElementById('tableBody');
            
            if (filteredData.length === 0) {
                if (currentData.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center">
                                <i class="fas fa-database text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-500 mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô ${currentCollection}</p>
                                <p class="text-sm text-gray-400 mb-4">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ</p>
                                <button onclick="openModal()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                    <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                </button>
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                <i class="fas fa-search text-3xl mb-2"></i>
                                <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                            </td>
                        </tr>
                    `;
                }
                return;
            }
            
            tbody.innerHTML = filteredData.map(item => {
                // Handle different field names
                const displayName = item.name || item.displayName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
                const email = item.email || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•';
                const photoURL = item.photoURL || item.avatarUrl || item.photoUrl;
                const role = item.role || 'user';
                const uid = item.uid || item.key || '‡πÑ‡∏°‡πà‡∏°‡∏µ UID';
                
                return `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${photoURL ? 
                            `<img src="${photoURL}" alt="avatar" class="h-10 w-10 rounded-full object-cover" 
                                onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=random';">` : 
                            `<div class="h-10 w-10 rounded-full bg-gradient-to-r from-purple-400 to-pink-500 flex items-center justify-center text-white font-bold">
                                ${displayName.charAt(0).toUpperCase()}
                            </div>`
                        }
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap font-mono text-xs">${uid.substring(0, 15)}...</td>
                    <td class="px-6 py-4 whitespace-nowrap font-medium">${displayName}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${email}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full ${role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-800'}">
                            ${role}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button onclick="editData('${item.id}')" class="text-blue-600 hover:text-blue-900 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="openDeleteModal('${item.id}', '${item.key || ''}')" class="text-red-600 hover:text-red-900">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `}).join('');
        }

        // Update data count
        function updateDataCount() {
            const count = currentData.length;
            document.getElementById('dataCount').innerHTML = `‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô ${currentCollection} ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong>${count}</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
        }

        // Modal functions
        function openModal() {
            document.getElementById('modalTitle').textContent = `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô ${currentCollection}`;
            document.getElementById('dataForm').reset();
            document.getElementById('dataId').value = '';
            document.getElementById('dataKey').value = '';
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // Save data
        function saveData(event) {
            event.preventDefault();
            
            const id = document.getElementById('dataId').value;
            const uid = document.getElementById('uid').value;
            const dataKey = document.getElementById('dataKey').value;
            
            const data = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                photoURL: document.getElementById('photoURL').value || null,
                role: document.getElementById('role').value,
                updatedAt: new Date().toISOString()
            };
            
            // Add uid if provided
            if (uid) {
                data.uid = uid;
            }
            
            const collectionRef = database.ref(currentCollection);
            
            if (id) {
                // Update existing
                collectionRef.child(id).update(data)
                    .then(() => {
                        closeModal();
                        showToast('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                        loadData();
                    })
                    .catch(error => {
                        console.error("Error updating:", error);
                        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                    });
            } else {
                // Create new
                data.createdAt = new Date().toISOString();
                
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ uid ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô Users ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ uid ‡πÄ‡∏õ‡πá‡∏ô key
                if (currentCollection === 'Users' && uid) {
                    collectionRef.child(uid).set(data)
                        .then(() => {
                            closeModal();
                            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                            loadData();
                        })
                        .catch(error => {
                            console.error("Error saving:", error);
                            showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                        });
                } else {
                    // ‡πÉ‡∏ä‡πâ push ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö users (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å)
                    collectionRef.push(data)
                        .then(() => {
                            closeModal();
                            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                            loadData();
                        })
                        .catch(error => {
                            console.error("Error saving:", error);
                            showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                        });
                }
            }
        }

        // Edit data
        function editData(id) {
            const item = currentData.find(d => d.id === id);
            if (item) {
                document.getElementById('modalTitle').textContent = `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô ${currentCollection}`;
                document.getElementById('dataId').value = item.id;
                document.getElementById('dataKey').value = item.key || '';
                document.getElementById('uid').value = item.uid || '';
                document.getElementById('name').value = item.name || item.displayName || '';
                document.getElementById('email').value = item.email || '';
                document.getElementById('photoURL').value = item.photoURL || item.avatarUrl || '';
                document.getElementById('role').value = item.role || 'user';
                document.getElementById('modal').classList.remove('hidden');
            }
        }

        // Delete functions
        function openDeleteModal(id, key) {
            deleteId = id;
            deleteKey = key;
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            deleteId = null;
            deleteKey = null;
            document.getElementById('deleteModal').classList.add('hidden');
        }

        function confirmDelete() {
            if (deleteId) {
                const collectionRef = database.ref(currentCollection);
                collectionRef.child(deleteId).remove()
                    .then(() => {
                        closeDeleteModal();
                        showToast('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                        loadData();
                    })
                    .catch(error => {
                        console.error("Error deleting:", error);
                        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                        closeDeleteModal();
                    });
            }
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = `fixed bottom-4 right-4 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white px-6 py-3 rounded-lg shadow-lg`;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', renderTable);
        document.getElementById('filterSelect').addEventListener('change', renderTable);

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            const deleteModal = document.getElementById('deleteModal');
            
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === deleteModal) {
                closeDeleteModal();
            }
        }
    </script>
</body>
</html>
