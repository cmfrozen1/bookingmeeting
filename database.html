<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firebase - ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-8 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firebase</h1>
            <button onclick="loadAllData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                <i class="fas fa-sync-alt"></i> ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
        </div>

        <!-- Tabs -->
        <div class="mb-4 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px text-sm font-medium text-center" id="tabs">
                <li class="mr-2">
                    <button onclick="showTab('settings')" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" id="tab-settings">Settings</button>
                </li>
                <li class="mr-2">
                    <button onclick="showTab('users-big')" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" id="tab-users-big">Users (‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà)</button>
                </li>
                <li class="mr-2">
                    <button onclick="showTab('users-small')" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" id="tab-users-small">users (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å)</button>
                </li>
                <li class="mr-2">
                    <button onclick="showTab('raw')" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" id="tab-raw">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö</button>
                </li>
            </ul>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="bg-blue-50 px-6 py-3 border-b">
                    <h2 class="font-bold text-blue-800">Settings Configuration</h2>
                </div>
                <div class="p-6" id="settings-content">
                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...
                </div>
            </div>
        </div>

        <!-- Users Big Tab (Uxxxxx format) -->
        <div id="users-big-tab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="bg-green-50 px-6 py-3 border-b flex justify-between items-center">
                    <h2 class="font-bold text-green-800">Users (‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà) - ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
                    <span id="users-big-count" class="bg-green-200 text-green-800 px-3 py-1 rounded-full text-sm">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">UID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
                            </tr>
                        </thead>
                        <tbody id="users-big-table" class="bg-white divide-y divide-gray-200">
                            <tr><td colspan="6" class="px-6 py-4 text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Users Small Tab (-Oxxxx format) -->
        <div id="users-small-tab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="bg-purple-50 px-6 py-3 border-b flex justify-between items-center">
                    <h2 class="font-bold text-purple-800">users (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å) - ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
                    <span id="users-small-count" class="bg-purple-200 text-purple-800 px-3 py-1 rounded-full text-sm">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡πÅ‡∏ú‡∏ô‡∏Å</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Avatar</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
                            </tr>
                        </thead>
                        <tbody id="users-small-table" class="bg-white divide-y divide-gray-200">
                            <tr><td colspan="7" class="px-6 py-4 text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Raw Data Tab -->
        <div id="raw-tab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="bg-gray-50 px-6 py-3 border-b">
                    <h2 class="font-bold text-gray-700">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏à‡∏≤‡∏Å Firebase (JSON)</h2>
                </div>
                <div class="p-4 bg-gray-50 font-mono text-sm overflow-auto max-h-96" id="raw-content">
                    <pre class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAxQr1PCwjWhoz143Ipzcjx9sq2hw5R9dc",
            authDomain: "cm-bookingroom.firebaseapp.com",
            databaseURL: "https://cm-bookingroom-default-rtdb.firebaseio.com",
            projectId: "cm-bookingroom",
            storageBucket: "cm-bookingroom.firebasestorage.app",
            messagingSenderId: "312076484549",
            appId: "1:312076484549:web:d9e1cb3e28747c1aa695ac"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("‚úÖ Firebase initialized successfully");
        } catch (error) {
            console.error("‚ùå Error initializing Firebase:", error);
        }

        const database = firebase.database();

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            showTab('users-big'); // ‡πÅ‡∏™‡∏î‡∏á Users (‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà) ‡∏Å‡πà‡∏≠‡∏ô
        });

        function loadAllData() {
            console.log("üîÑ Loading all data from Firebase...");
            
            const rootRef = database.ref();
            
            rootRef.once('value', (snapshot) => {
                const data = snapshot.val();
                console.log("üì¶ Data loaded:", data);
                
                if (data) {
                    // ‡πÅ‡∏™‡∏î‡∏á Settings
                    displaySettings(data.Settings);
                    
                    // ‡πÅ‡∏™‡∏î‡∏á Users (‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà)
                    if (data.Users) {
                        displayUsersBig(data.Users);
                    } else {
                        document.getElementById('users-big-table').innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Users</td></tr>';
                        document.getElementById('users-big-count').textContent = '0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
                    }
                    
                    // ‡πÅ‡∏™‡∏î‡∏á users (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å)
                    if (data.users) {
                        displayUsersSmall(data.users);
                    } else {
                        document.getElementById('users-small-table').innerHTML = '<tr><td colspan="7" class="px-6 py-4 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô users</td></tr>';
                        document.getElementById('users-small-count').textContent = '0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
                    }
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö
                    displayRawData(data);
                } else {
                    showNoData();
                }
                
            }, (error) => {
                console.error("‚ùå Error:", error);
                showError(error.message);
            });
        }

        function displaySettings(settings) {
            const content = document.getElementById('settings-content');
            
            if (!settings) {
                content.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Settings</p>';
                return;
            }
            
            let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
            
            Object.keys(settings).forEach(key => {
                const value = settings[key];
                html += `
                    <div class="border rounded-lg p-4">
                        <h3 class="font-bold text-gray-700 mb-2">${key}</h3>
                        <pre class="bg-gray-50 p-2 rounded text-sm">${JSON.stringify(value, null, 2)}</pre>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function displayUsersBig(users) {
            const tbody = document.getElementById('users-big-table');
            const count = Object.keys(users).length;
            
            document.getElementById('users-big-count').textContent = `${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            
            if (count === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                return;
            }
            
            let html = '';
            Object.keys(users).forEach(uid => {
                const user = users[uid];
                const created = user.createdAt ? new Date(user.createdAt).toLocaleString('th-TH') : '-';
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap font-mono text-xs">${uid}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${user.email || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${user.displayName || user.name || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${user.photoURL ? 
                                `<img src="${user.photoURL}" class="h-8 w-8 rounded-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'User')}'">` : 
                                '<span class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</span>'
                            }
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs rounded-full ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-gray-100 text-gray-800'}">
                                ${user.role || 'user'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${created}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function displayUsersSmall(users) {
            const tbody = document.getElementById('users-small-table');
            const count = Object.keys(users).length;
            
            document.getElementById('users-small-count').textContent = `${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            
            if (count === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-4 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                return;
            }
            
            let html = '';
            Object.keys(users).forEach(id => {
                const user = users[id];
                const created = user.createdAt ? new Date(user.createdAt).toLocaleString('th-TH') : '-';
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap font-mono text-xs">${id.substring(0, 8)}...</td>
                        <td class="px-6 py-4 whitespace-nowrap font-medium">${user.name || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${user.email || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">
                                ${user.department || '-'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs rounded-full ${user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${user.status || 'inactive'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${user.avatarUrl ? 
                                `<img src="${user.avatarUrl}" class="h-8 w-8 rounded-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.name || 'User')}'">` : 
                                '<span class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</span>'
                            }
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${created}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function displayRawData(data) {
            const content = document.getElementById('raw-content');
            content.innerHTML = `<pre class="text-gray-700">${JSON.stringify(data, null, 2)}</pre>`;
        }

        function showNoData() {
            const tables = ['users-big-table', 'users-small-table'];
            tables.forEach(id => {
                document.getElementById(id).innerHTML = '<tr><td colspan="7" class="px-6 py-4 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
            });
            document.getElementById('settings-content').innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Settings</p>';
            document.getElementById('raw-content').innerHTML = '<pre class="text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</pre>';
        }

        function showError(message) {
            const tables = ['users-big-table', 'users-small-table'];
            tables.forEach(id => {
                document.getElementById(id).innerHTML = `<tr><td colspan="7" class="px-6 py-4 text-center text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${message}</td></tr>`;
            });
            document.getElementById('settings-content').innerHTML = `<p class="text-red-500 text-center py-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${message}</p>`;
            document.getElementById('raw-content').innerHTML = `<pre class="text-red-500">Error: ${message}</pre>`;
        }

        function showTab(tabName) {
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å tab
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.add('hidden');
            });
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏° tab
            document.querySelectorAll('#tabs button').forEach(btn => {
                btn.classList.remove('border-blue-600', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // ‡πÅ‡∏™‡∏î‡∏á tab ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            let tabId;
            switch(tabName) {
                case 'settings':
                    tabId = 'settings-tab';
                    document.getElementById('tab-settings').classList.add('border-blue-600', 'text-blue-600');
                    break;
                case 'users-big':
                    tabId = 'users-big-tab';
                    document.getElementById('tab-users-big').classList.add('border-blue-600', 'text-blue-600');
                    break;
                case 'users-small':
                    tabId = 'users-small-tab';
                    document.getElementById('tab-users-small').classList.add('border-blue-600', 'text-blue-600');
                    break;
                case 'raw':
                    tabId = 'raw-tab';
                    document.getElementById('tab-raw').classList.add('border-blue-600', 'text-blue-600');
                    break;
            }
            
            document.getElementById(tabId).classList.remove('hidden');
        }
    </script>
</body>
</html>
