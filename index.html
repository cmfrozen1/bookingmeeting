<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Meeting Room Â· LINE</title>
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/1040/1040244.png">
    <link rel="preconnect" href="https://static.line-scdn.net">
    <link rel="preconnect" href="https://script.google.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- LINE LIFF -->
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'IBM Plex Sans Thai',sans-serif}
        :root{
            --primary:#06c755;--primary-dark:#05b34a;
            --bg:#0a0a0f;--bg-card:#1a1d24;--border:#2a2e36;
            --text:#fff;--text-secondary:#9ca3af;
            --warning:#f59e0b;--danger:#ef4444;
        }
        html{scroll-behavior:smooth}
        body{background:var(--bg);color:var(--text);padding-bottom:70px;min-height:100vh}

        /* â”€â”€ Navbar â”€â”€ */
        .navbar{position:sticky;top:0;z-index:40;background:rgba(10,10,15,.95);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);padding:12px 16px}
        .navbar-content{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
        .navbar-logo{display:flex;align-items:center;gap:8px;cursor:pointer}
        .navbar-logo i{color:var(--primary);font-size:24px}

        /* â”€â”€ Bottom Nav â”€â”€ */
        .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--bg-card);border-top:1px solid var(--border);display:flex;justify-content:space-around;padding:8px 0;z-index:50}
        .nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;color:var(--text-secondary);font-size:12px;cursor:pointer;transition:color .2s}
        .nav-item.active{color:var(--primary)}

        /* â”€â”€ Profile â”€â”€ */
        .profile-header{background:var(--bg-card);border-radius:20px;padding:16px;margin:16px;display:flex;align-items:center;gap:16px;border:1px solid var(--border);cursor:pointer}
        .profile-avatar{width:60px;height:60px;border-radius:30px;border:3px solid var(--primary);object-fit:cover;flex-shrink:0}

        /* â”€â”€ Quick Actions â”€â”€ */
        .quick-actions{display:flex;gap:8px;padding:0 16px;margin-bottom:16px}
        .quick-action-btn{flex:1;background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center;cursor:pointer;transition:border-color .2s,background .2s}
        .quick-action-btn:active{background:#252930;border-color:var(--primary)}

        /* â”€â”€ Stats â”€â”€ */
        .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:1200px;margin:0 auto 16px;padding:0 16px}
        .stat-card{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:16px;text-align:center}

        /* â”€â”€ Rooms â”€â”€ */
        .rooms-grid{display:grid;grid-template-columns:1fr;gap:16px;padding:0 16px;max-width:1200px;margin:0 auto}
        @media(min-width:768px){.rooms-grid{grid-template-columns:repeat(2,1fr)}}
        @media(min-width:1024px){.rooms-grid{grid-template-columns:repeat(3,1fr)}}
        .room-card{background:var(--bg-card);border:1px solid var(--border);border-radius:20px;overflow:hidden;cursor:pointer;transition:transform .15s,border-color .15s}
        .room-card:active{transform:scale(.98);border-color:var(--primary)}
        .room-image{width:100%;height:160px;background:linear-gradient(135deg,#2a2e36,#1a1d24);display:flex;align-items:center;justify-content:center;overflow:hidden}
        .room-image img{width:100%;height:100%;object-fit:cover}
        .room-content{padding:16px}

        /* â”€â”€ Booking List â”€â”€ */
        .booking-card{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px}
        .status-badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:600}
        .status-confirmed{background:rgba(6,199,85,.15);color:var(--primary)}
        .status-pending{background:rgba(245,158,11,.15);color:var(--warning)}
        .status-cancelled{background:rgba(239,68,68,.15);color:var(--danger)}

        /* â”€â”€ Admin Panel â”€â”€ */
        .admin-section{background:var(--bg-card);border:1px solid var(--border);border-radius:20px;padding:16px;margin:16px}
        .admin-btn{display:block;width:100%;padding:12px;border:none;border-radius:12px;background:var(--primary);color:#000;font-weight:600;font-size:15px;cursor:pointer;margin-bottom:8px;transition:background .2s}
        .admin-btn:hover{background:var(--primary-dark)}
        .admin-btn.secondary{background:var(--bg);border:1px solid var(--border);color:var(--text)}
        .admin-table{width:100%;border-collapse:collapse;font-size:13px}
        .admin-table th{text-align:left;padding:10px 8px;border-bottom:1px solid var(--border);color:var(--text-secondary);font-weight:500}
        .admin-table td{padding:10px 8px;border-bottom:1px solid var(--border)}

        /* â”€â”€ Skeleton â”€â”€ */
        .skeleton{background:linear-gradient(90deg,var(--bg-card) 25%,#252930 50%,var(--bg-card) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:8px}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

        /* â”€â”€ Form styles â”€â”€ */
        .form-group{margin-bottom:12px}
        .form-group label{display:block;font-size:13px;color:var(--text-secondary);margin-bottom:4px}
        .form-input{width:100%;padding:10px 12px;background:var(--bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px}
        .form-input:focus{outline:none;border-color:var(--primary)}

        /* â”€â”€ Upload zone â”€â”€ */
        .upload-zone{border:2px dashed var(--border);border-radius:12px;padding:24px;text-align:center;cursor:pointer;transition:border-color .2s}
        .upload-zone:hover,.upload-zone.drag{border-color:var(--primary);background:rgba(6,199,85,.05)}
        .upload-zone input[type=file]{display:none}
        .upload-preview{width:100%;max-height:160px;object-fit:cover;border-radius:10px;margin-top:10px}
        .upload-progress{height:4px;background:var(--border);border-radius:2px;overflow:hidden;margin-top:8px}
        .upload-progress-bar{height:100%;background:var(--primary);width:0%;transition:width .3s}

        /* â”€â”€ Toast â”€â”€ */
        .toast-container{position:fixed;top:70px;left:50%;transform:translateX(-50%);z-index:9999;display:flex;flex-direction:column;gap:8px;pointer-events:none;width:90%;max-width:360px}
        .toast{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:12px 16px;font-size:14px;display:flex;align-items:center;gap:10px;animation:toastIn .3s ease;pointer-events:auto;box-shadow:0 4px 20px rgba(0,0,0,.4)}
        .toast.success{border-color:var(--primary)}
        .toast.error{border-color:var(--danger)}
        .toast.warning{border-color:var(--warning)}
        @keyframes toastIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

        /* â”€â”€ Modal overlay â”€â”€ */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:100;display:flex;align-items:flex-end;justify-content:center;backdrop-filter:blur(4px)}
        .modal-overlay.hidden{display:none}
        .modal-sheet{background:var(--bg-card);border-radius:24px 24px 0 0;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;padding:20px;animation:slideUp .3s ease}
        @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
        .modal-handle{width:40px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 16px}
        .modal-close{position:absolute;top:16px;right:16px;background:var(--bg);border:1px solid var(--border);border-radius:50%;width:32px;height:32px;cursor:pointer;color:var(--text-secondary);display:flex;align-items:center;justify-content:center}

        /* â”€â”€ Loader â”€â”€ */
        .spinner{width:20px;height:20px;border:2px solid rgba(255,255,255,.2);border-top-color:var(--primary);border-radius:50%;animation:spin .6s linear infinite;display:inline-block}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* â”€â”€ Tabs â”€â”€ */
        .page{display:none}.page.active{display:block}

        .hidden{display:none!important}

        /* â”€â”€ Search â”€â”€ */
        .search-wrap{position:relative;max-width:1200px;margin:0 auto 16px;padding:0 16px}
        .search-wrap i{position:absolute;left:28px;top:50%;transform:translateY(-50%);color:var(--text-secondary);pointer-events:none}
        .search-input{width:100%;padding:12px 12px 12px 44px;background:var(--bg-card);border:1px solid var(--border);border-radius:30px;color:var(--text);font-size:14px}
        .search-input:focus{outline:none;border-color:var(--primary)}
    </style>
</head>
<body>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

<!-- Navbar -->
<nav class="navbar">
    <div class="navbar-content">
        <div class="navbar-logo" id="nav-home">
            <i class="fas fa-door-open"></i>
            <span>Meeting Room</span>
        </div>
        <div id="nav-loader" class="hidden"><div class="spinner"></div></div>
    </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAGES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- PAGE: Home -->
<div id="page-home" class="page active">

    <!-- Profile Skeleton -->
    <div class="profile-header" id="profile-skeleton">
        <div class="skeleton" style="width:60px;height:60px;border-radius:30px;flex-shrink:0"></div>
        <div style="flex:1">
            <div class="skeleton" style="height:18px;width:140px;margin-bottom:8px"></div>
            <div class="skeleton" style="height:13px;width:180px"></div>
        </div>
    </div>

    <!-- Profile Real -->
    <div class="profile-header hidden" id="profile-real" id="btn-open-profile">
        <img id="profile-avatar" src="" alt="avatar" class="profile-avatar" onerror="this.src='https://via.placeholder.com/60/2a2e36/06c755?text=U'">
        <div style="flex:1;min-width:0">
            <h2 id="profile-name" style="font-size:17px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"></h2>
            <p id="profile-email" style="font-size:13px;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis"></p>
            <p id="profile-role" style="font-size:12px;color:var(--primary);margin-top:3px"></p>
        </div>
        <i class="fas fa-chevron-right" style="color:var(--text-secondary)"></i>
    </div>

    <!-- Quick Actions Skeleton -->
    <div class="quick-actions" id="quick-actions-skeleton">
        <div class="skeleton" style="flex:1;height:70px;border-radius:12px"></div>
        <div class="skeleton" style="flex:1;height:70px;border-radius:12px"></div>
        <div class="skeleton" style="flex:1;height:70px;border-radius:12px"></div>
    </div>

    <!-- Quick Actions Real -->
    <div class="quick-actions hidden" id="quick-actions-real">
        <div class="quick-action-btn" id="btn-quick-book">
            <div style="font-size:20px;color:var(--primary);margin-bottom:4px"><i class="fas fa-calendar-plus"></i></div>
            <div style="font-size:12px;color:var(--text-secondary)">à¸ˆà¸­à¸‡à¸”à¹ˆà¸§à¸™</div>
        </div>
        <div class="quick-action-btn" id="btn-today">
            <div style="font-size:20px;color:var(--primary);margin-bottom:4px"><i class="fas fa-calendar-day"></i></div>
            <div style="font-size:12px;color:var(--text-secondary)">à¸§à¸±à¸™à¸™à¸µà¹‰</div>
        </div>
        <div class="quick-action-btn" id="btn-all-rooms">
            <div style="font-size:20px;color:var(--primary);margin-bottom:4px"><i class="fas fa-door-open"></i></div>
            <div style="font-size:12px;color:var(--text-secondary)">à¸«à¹‰à¸­à¸‡à¸§à¹ˆà¸²à¸‡</div>
        </div>
    </div>

    <!-- Stats Skeleton -->
    <div class="stats-grid" id="stats-skeleton">
        <div class="skeleton" style="height:70px;border-radius:16px"></div>
        <div class="skeleton" style="height:70px;border-radius:16px"></div>
        <div class="skeleton" style="height:70px;border-radius:16px"></div>
    </div>

    <!-- Stats Real -->
    <div class="stats-grid hidden" id="stats-real">
        <div class="stat-card">
            <p style="font-size:12px;color:var(--text-secondary)">à¸«à¹‰à¸­à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</p>
            <p id="stat-rooms" style="font-size:20px;font-weight:700;color:var(--primary)">0</p>
        </div>
        <div class="stat-card">
            <p style="font-size:12px;color:var(--text-secondary)">à¸ˆà¸­à¸‡à¸§à¸±à¸™à¸™à¸µà¹‰</p>
            <p id="stat-today" style="font-size:20px;font-weight:700;color:var(--primary)">0</p>
        </div>
        <div class="stat-card">
            <p style="font-size:12px;color:var(--text-secondary)">à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´</p>
            <p id="stat-pending" style="font-size:20px;font-weight:700;color:var(--warning)">0</p>
        </div>
    </div>

    <!-- Search -->
    <div class="search-wrap">
        <i class="fas fa-search"></i>
        <input type="text" id="search-input" class="search-input" placeholder="à¸„à¹‰à¸™à¸«à¸²à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡...">
    </div>

    <!-- Rooms -->
    <div id="rooms-list" class="rooms-grid">
        <div class="skeleton" style="height:250px;border-radius:20px"></div>
        <div class="skeleton" style="height:250px;border-radius:20px"></div>
        <div class="skeleton" style="height:250px;border-radius:20px"></div>
    </div>
</div>

<!-- PAGE: My Bookings -->
<div id="page-my" class="page">
    <div style="padding:16px;max-width:600px;margin:0 auto">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
            <h2 style="font-size:18px;font-weight:700">à¸à¸²à¸£à¸ˆà¸­à¸‡à¸‚à¸­à¸‡à¸‰à¸±à¸™</h2>
            <button onclick="openBookingModal()" style="background:var(--primary);color:#000;border:none;border-radius:10px;padding:8px 14px;font-weight:600;cursor:pointer;font-size:13px">
                <i class="fas fa-plus"></i> à¸ˆà¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ
            </button>
        </div>
        <div id="my-bookings-list">
            <div class="skeleton" style="height:100px;border-radius:16px;margin-bottom:12px"></div>
            <div class="skeleton" style="height:100px;border-radius:16px;margin-bottom:12px"></div>
        </div>
    </div>
</div>

<!-- PAGE: Admin -->
<div id="page-admin" class="page">
    <div style="padding:16px;max-width:800px;margin:0 auto">
        <h2 style="font-size:18px;font-weight:700;margin-bottom:16px">à¸ˆà¸±à¸”à¸à¸²à¸£à¸£à¸°à¸šà¸š</h2>

        <div class="admin-section">
            <h3 style="margin-bottom:12px;font-size:15px">à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡</h3>
            <button class="admin-btn" onclick="openAddRoomModal()">
                <i class="fas fa-plus"></i> à¹€à¸à¸´à¹ˆà¸¡à¸«à¹‰à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ
            </button>
            <div id="admin-rooms-list" style="margin-top:12px;overflow-x:auto">
                <div class="skeleton" style="height:200px;border-radius:12px"></div>
            </div>
        </div>

        <div class="admin-section" id="admin-bookings-section">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
                <h3 style="font-size:15px">à¸à¸²à¸£à¸ˆà¸­à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</h3>
                <button onclick="loadAdminBookings()" style="background:none;border:1px solid var(--border);border-radius:8px;padding:6px 10px;color:var(--text-secondary);cursor:pointer;font-size:12px">
                    <i class="fas fa-sync-alt"></i> à¸£à¸µà¹‚à¸«à¸¥à¸”
                </button>
            </div>
            <div id="admin-bookings-list">
                <div class="skeleton" style="height:200px;border-radius:12px"></div>
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="bottom-nav">
    <div class="nav-item active" data-tab="home">
        <i class="fas fa-door-open"></i>
        <span>à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸</span>
    </div>
    <div class="nav-item" data-tab="my">
        <i class="fas fa-calendar-check"></i>
        <span>à¸à¸²à¸£à¸ˆà¸­à¸‡</span>
    </div>
    <div class="nav-item hidden admin-only" data-tab="admin">
        <i class="fas fa-cog"></i>
        <span>à¸ˆà¸±à¸”à¸à¸²à¸£</span>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- Modal: Booking -->
<div class="modal-overlay hidden" id="modal-booking">
    <div class="modal-sheet" style="position:relative">
        <div class="modal-handle"></div>
        <button class="modal-close" onclick="closeModal('modal-booking')"><i class="fas fa-times"></i></button>
        <h3 style="font-size:17px;font-weight:700;margin-bottom:16px">à¸ˆà¸­à¸‡à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡</h3>

        <div class="form-group">
            <label>à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡</label>
            <select id="bk-room" class="form-input">
                <option value="">à¹€à¸¥à¸·à¸­à¸à¸«à¹‰à¸­à¸‡</option>
            </select>
        </div>
        <div class="form-group">
            <label>à¸«à¸±à¸§à¸‚à¹‰à¸­à¸à¸²à¸£à¸›à¸£à¸°à¸Šà¸¸à¸¡</label>
            <input type="text" id="bk-title" class="form-input" placeholder="à¸à¸£à¸­à¸à¸«à¸±à¸§à¸‚à¹‰à¸­...">
        </div>
        <div class="form-group">
            <label>à¸§à¸±à¸™à¸—à¸µà¹ˆ</label>
            <input type="date" id="bk-date" class="form-input">
        </div>
        <div style="display:flex;gap:8px;margin-bottom:12px">
            <div class="form-group" style="flex:1;margin-bottom:0">
                <label>à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡</label>
                <input type="time" id="bk-start" class="form-input" value="09:00">
            </div>
            <div class="form-group" style="flex:1;margin-bottom:0">
                <label>à¹€à¸§à¸¥à¸²à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”</label>
                <input type="time" id="bk-end" class="form-input" value="10:00">
            </div>
        </div>
        <div class="form-group">
            <label>à¸ˆà¸³à¸™à¸§à¸™à¸œà¸¹à¹‰à¹€à¸‚à¹‰à¸²à¸£à¹ˆà¸§à¸¡</label>
            <input type="number" id="bk-attendees" class="form-input" value="4" min="1">
        </div>
        <div class="form-group">
            <label>à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ (à¸–à¹‰à¸²à¸¡à¸µ)</label>
            <textarea id="bk-note" class="form-input" rows="2" placeholder="à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡..." style="resize:none"></textarea>
        </div>

        <button id="bk-submit-btn" onclick="submitBooking()" style="width:100%;padding:14px;background:var(--primary);color:#000;border:none;border-radius:12px;font-weight:700;font-size:15px;cursor:pointer;margin-top:4px">
            à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸ˆà¸­à¸‡
        </button>
    </div>
</div>

<!-- Modal: Room Detail -->
<div class="modal-overlay hidden" id="modal-room-detail">
    <div class="modal-sheet" style="position:relative">
        <div class="modal-handle"></div>
        <button class="modal-close" onclick="closeModal('modal-room-detail')"><i class="fas fa-times"></i></button>
        <div id="room-detail-content"></div>
    </div>
</div>

<!-- Modal: Add/Edit Room (Admin) -->
<div class="modal-overlay hidden" id="modal-add-room">
    <div class="modal-sheet" style="position:relative">
        <div class="modal-handle"></div>
        <button class="modal-close" onclick="closeModal('modal-add-room')"><i class="fas fa-times"></i></button>
        <h3 id="add-room-title" style="font-size:17px;font-weight:700;margin-bottom:16px">à¹€à¸à¸´à¹ˆà¸¡à¸«à¹‰à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ</h3>

        <input type="hidden" id="room-edit-id">

        <div class="form-group">
            <label>à¸Šà¸·à¹ˆà¸­à¸«à¹‰à¸­à¸‡ *</label>
            <input type="text" id="room-name" class="form-input" placeholder="à¹€à¸Šà¹ˆà¸™ à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡ A">
        </div>
        <div style="display:flex;gap:8px;margin-bottom:12px">
            <div class="form-group" style="flex:1;margin-bottom:0">
                <label>à¸„à¸§à¸²à¸¡à¸ˆà¸¸ (à¸„à¸™) *</label>
                <input type="number" id="room-capacity" class="form-input" value="10" min="1">
            </div>
            <div class="form-group" style="flex:1;margin-bottom:0">
                <label>à¸Šà¸±à¹‰à¸™/à¸­à¸²à¸„à¸²à¸£</label>
                <input type="text" id="room-location" class="form-input" placeholder="à¹€à¸Šà¹ˆà¸™ à¸Šà¸±à¹‰à¸™ 3">
            </div>
        </div>
        <div class="form-group">
            <label>à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢</label>
            <textarea id="room-description" class="form-input" rows="2" style="resize:none" placeholder="à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸«à¹‰à¸­à¸‡..."></textarea>
        </div>
        <div class="form-group">
            <label>à¸ªà¸´à¹ˆà¸‡à¸­à¸³à¸™à¸§à¸¢à¸„à¸§à¸²à¸¡à¸ªà¸°à¸”à¸§à¸</label>
            <input type="text" id="room-facilities" class="form-input" placeholder="à¹€à¸Šà¹ˆà¸™ à¹‚à¸›à¸£à¹€à¸ˆà¸„à¹€à¸•à¸­à¸£à¹Œ, TV, à¹„à¸§à¸—à¹Œà¸šà¸­à¸£à¹Œà¸”">
        </div>

        <!-- Upload Zone -->
        <div class="form-group">
            <label>à¸£à¸¹à¸›à¸ à¸²à¸à¸«à¹‰à¸­à¸‡ (à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ 5MB)</label>
            <div class="upload-zone" id="upload-zone" onclick="document.getElementById('room-image-file').click()">
                <input type="file" id="room-image-file" accept="image/*">
                <div id="upload-placeholder">
                    <i class="fas fa-cloud-upload-alt" style="font-size:28px;color:var(--primary);margin-bottom:8px"></i>
                    <p style="font-size:13px;color:var(--text-secondary)">à¸„à¸¥à¸´à¸à¸«à¸£à¸·à¸­à¸¥à¸²à¸à¹„à¸Ÿà¸¥à¹Œà¸¡à¸²à¸§à¸²à¸‡</p>
                    <p style="font-size:11px;color:var(--text-secondary);margin-top:4px">JPG, PNG, WEBP à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ 5MB</p>
                </div>
                <img id="upload-preview" class="upload-preview hidden" alt="preview">
            </div>
            <div class="upload-progress hidden" id="upload-progress-wrap">
                <div class="upload-progress-bar" id="upload-progress-bar"></div>
            </div>
            <p id="upload-status" style="font-size:12px;color:var(--text-secondary);margin-top:4px"></p>
        </div>

        <button id="room-submit-btn" onclick="submitRoom()" style="width:100%;padding:14px;background:var(--primary);color:#000;border:none;border-radius:12px;font-weight:700;font-size:15px;cursor:pointer">
            à¸šà¸±à¸™à¸—à¸¶à¸
        </button>
    </div>
</div>

<!-- Font Awesome async -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CONFIG = {
    GAS_URL: 'https://script.google.com/macros/s/AKfycbwEkTSINEvnyBdapUWbJ8djVpdLt6rN7NlaXn5cKMow7RJtY3gI19-RSMyFHsWBxII-vA/exec',
    LIFF_ID: '2008904120-nqYHD5BT',
    MAX_FILE_SIZE: 5 * 1024 * 1024, // 5MB
    API_TIMEOUT: 20000,
    CHUNK_SIZE: 256 * 1024 // 256KB per chunk for large files
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const state = {
    user: null,
    rooms: [],
    myBookings: [],
    isAdmin: false,
    isManager: false,
    currentTab: 'home',
    pendingRoomId: null,
    uploadedImageUrl: '',
    initialized: false
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM CACHE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const $id = id => document.getElementById(id);
const DOM = {
    profileSkeleton: $id('profile-skeleton'),
    profileReal: $id('profile-real'),
    quickActionsSkeleton: $id('quick-actions-skeleton'),
    quickActionsReal: $id('quick-actions-real'),
    statsSkeleton: $id('stats-skeleton'),
    statsReal: $id('stats-real'),
    roomsList: $id('rooms-list'),
    profileName: $id('profile-name'),
    profileEmail: $id('profile-email'),
    profileAvatar: $id('profile-avatar'),
    profileRole: $id('profile-role'),
    statRooms: $id('stat-rooms'),
    statToday: $id('stat-today'),
    statPending: $id('stat-pending'),
    searchInput: $id('search-input'),
    navItems: document.querySelectorAll('.nav-item'),
    adminOnly: document.querySelectorAll('.admin-only'),
    navLoader: $id('nav-loader')
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg, type = 'success', duration = 3000) {
    const icons = { success: 'fa-check-circle', error: 'fa-exclamation-circle', warning: 'fa-exclamation-triangle', info: 'fa-info-circle' };
    const colors = { success: 'var(--primary)', error: 'var(--danger)', warning: 'var(--warning)', info: '#60a5fa' };
    const el = document.createElement('div');
    el.className = `toast ${type}`;
    el.innerHTML = `<i class="fas ${icons[type]||icons.info}" style="color:${colors[type]};flex-shrink:0"></i><span>${msg}</span>`;
    const container = $id('toast-container');
    container.appendChild(el);
    setTimeout(() => { el.style.animation = 'toastIn .3s ease reverse'; setTimeout(() => el.remove(), 300); }, duration);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOADER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let loadingCount = 0;
function setLoading(on) {
    loadingCount = Math.max(0, loadingCount + (on ? 1 : -1));
    DOM.navLoader.classList.toggle('hidden', loadingCount === 0);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function callGAS(path, data = {}, showLoader = false) {
    if (showLoader) setLoading(true);
    try {
        const formData = new FormData();
        formData.append('path', path);
        if (state.user?.lineUserId) formData.append('lineUserId', state.user.lineUserId);
        Object.entries(data).forEach(([k, v]) => { if (v !== undefined && v !== null) formData.append(k, v); });

        const controller = new AbortController();
        const tid = setTimeout(() => controller.abort(), CONFIG.API_TIMEOUT);

        const res = await fetch(CONFIG.GAS_URL, { method: 'POST', body: formData, signal: controller.signal });
        clearTimeout(tid);
        const text = await res.text();
        return JSON.parse(text);
    } catch (e) {
        console.error('API Error [' + path + ']:', e);
        return { success: false, message: e.name === 'AbortError' ? 'à¸«à¸¡à¸”à¹€à¸§à¸¥à¸²à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­' : 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸”à¹‰' };
    } finally {
        if (showLoader) setLoading(false);
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILE UPLOAD â€” à¹à¸šà¹ˆà¸‡ chunk à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸–à¹‰à¸²à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¸à¹ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

function setUploadProgress(pct) {
    const wrap = $id('upload-progress-wrap');
    const bar = $id('upload-progress-bar');
    wrap.classList.toggle('hidden', pct <= 0 || pct >= 100);
    bar.style.width = pct + '%';
}

function setUploadStatus(msg, color = 'var(--text-secondary)') {
    const el = $id('upload-status');
    el.textContent = msg;
    el.style.color = color;
}

async function uploadImage(file) {
    if (!file || !file.size) return null;

    if (file.size > CONFIG.MAX_FILE_SIZE) {
        showToast('à¸£à¸¹à¸›à¸ à¸²à¸à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸‚à¸™à¸²à¸”à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ 5MB', 'error');
        return null;
    }

    // Validate type
    if (!file.type.startsWith('image/')) {
        showToast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¹„à¸Ÿà¸¥à¹Œà¸£à¸¹à¸›à¸ à¸²à¸à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™', 'error');
        return null;
    }

    setUploadStatus('à¸à¸³à¸¥à¸±à¸‡à¹€à¸•à¸£à¸µà¸¢à¸¡à¹„à¸Ÿà¸¥à¹Œ...');
    setUploadProgress(10);

    try {
        // à¸ªà¸³à¸«à¸£à¸±à¸šà¹„à¸Ÿà¸¥à¹Œà¸‚à¸™à¸²à¸”à¹€à¸¥à¹‡à¸ (< 1MB) à¸ªà¹ˆà¸‡à¸„à¸£à¸±à¹‰à¸‡à¹€à¸”à¸µà¸¢à¸§
        if (file.size <= 1024 * 1024) {
            setUploadStatus('à¸à¸³à¸¥à¸±à¸‡à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”...', 'var(--primary)');
            setUploadProgress(40);

            const base64 = await fileToBase64(file);
            setUploadProgress(70);

            const result = await callGAS('uploadImage', {
                fileName: file.name,
                fileData: base64,
                mimeType: file.type,
                fileSize: file.size
            });

            setUploadProgress(100);

            if (result.success) {
                setUploadStatus('à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ âœ“', 'var(--primary)');
                return result.data?.url || result.data?.fileUrl || null;
            } else {
                setUploadStatus(result.message || 'à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'var(--danger)');
                showToast(result.message || 'à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¸£à¸¹à¸›à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'error');
                return null;
            }
        }

        // à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¸à¹ˆ â†’ à¹à¸šà¹ˆà¸‡ chunk
        const base64Full = await fileToBase64(file);
        setUploadProgress(20);

        const chunkSize = Math.ceil(CONFIG.CHUNK_SIZE * 4 / 3); // base64 size
        const chunks = [];
        for (let i = 0; i < base64Full.length; i += chunkSize) {
            chunks.push(base64Full.slice(i, i + chunkSize));
        }

        // à¸ªà¹ˆà¸‡ chunk à¹à¸£à¸ (à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ session)
        setUploadStatus(`à¸à¸³à¸¥à¸±à¸‡à¸­à¸±à¸›à¹‚à¸«à¸¥à¸” (0/${chunks.length})...`, 'var(--primary)');
        let sessionId = null;

        for (let i = 0; i < chunks.length; i++) {
            const pct = Math.round(20 + (i / chunks.length) * 70);
            setUploadProgress(pct);
            setUploadStatus(`à¸à¸³à¸¥à¸±à¸‡à¸­à¸±à¸›à¹‚à¸«à¸¥à¸” (${i + 1}/${chunks.length})...`, 'var(--primary)');

            const result = await callGAS('uploadImageChunk', {
                fileName: file.name,
                chunk: chunks[i],
                chunkIndex: i,
                totalChunks: chunks.length,
                mimeType: file.type,
                sessionId: sessionId || ''
            });

            if (!result.success) {
                setUploadStatus('à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'var(--danger)');
                showToast(result.message || 'à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'error');
                return null;
            }

            if (i === 0 && result.data?.sessionId) sessionId = result.data.sessionId;

            // chunk à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢ â†’ à¹„à¸”à¹‰ URL
            if (i === chunks.length - 1) {
                setUploadProgress(100);
                setUploadStatus('à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ âœ“', 'var(--primary)');
                return result.data?.url || result.data?.fileUrl || null;
            }
        }

        return null;
    } catch (e) {
        console.error('Upload error:', e);
        setUploadStatus('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”', 'var(--danger)');
        showToast('à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¸£à¸¹à¸›à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'error');
        setUploadProgress(0);
        return null;
    }
}

// Upload preview & drag-drop
function setupUploadZone() {
    const zone = $id('upload-zone');
    const fileInput = $id('room-image-file');
    const preview = $id('upload-preview');

    fileInput.addEventListener('change', e => handleFileSelect(e.target.files[0]));

    zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag'); });
    zone.addEventListener('dragleave', () => zone.classList.remove('drag'));
    zone.addEventListener('drop', e => {
        e.preventDefault();
        zone.classList.remove('drag');
        const f = e.dataTransfer.files[0];
        if (f) handleFileSelect(f);
    });

    function handleFileSelect(file) {
        if (!file) return;
        if (!file.type.startsWith('image/')) { showToast('à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¹„à¸Ÿà¸¥à¹Œà¸£à¸¹à¸›à¸ à¸²à¸', 'error'); return; }
        if (file.size > CONFIG.MAX_FILE_SIZE) { showToast('à¹„à¸Ÿà¸¥à¹Œà¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ 5MB', 'error'); return; }

        // Show preview immediately
        const reader = new FileReader();
        reader.onload = ev => {
            preview.src = ev.target.result;
            preview.classList.remove('hidden');
            $id('upload-placeholder').classList.add('hidden');
        };
        reader.readAsDataURL(file);

        state._pendingFile = file;
        setUploadProgress(0);
        setUploadStatus(`à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§: ${file.name} (${(file.size/1024).toFixed(0)}KB)`);
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function init() {
    try {
        await liff.init({ liffId: CONFIG.LIFF_ID });

        if (!liff.isLoggedIn()) {
            liff.login();
            return;
        }

        // Parallel: profile + rooms
        const profilePromise = liff.getProfile();
        const roomsPromise = callGAS('rooms', {});

        const profile = await profilePromise;

        // User profile + rooms in parallel
        const [userResult, roomsResult] = await Promise.all([
            callGAS('user/profile', {
                lineUserId: profile.userId,
                displayName: profile.displayName,
                pictureUrl: profile.pictureUrl || '',
                email: ''
            }),
            roomsPromise
        ]);

        if (userResult.success) {
            state.user = userResult.data;
            state.isAdmin = state.user.role === 'admin';
            state.isManager = state.isAdmin || state.user.role === 'manager';
            updateProfileUI();
        }

        if (roomsResult.success) {
            state.rooms = roomsResult.data || [];
            renderRooms();
            DOM.statRooms.textContent = state.rooms.length;
        }

        showRealUI();
        state.initialized = true;

        // Non-blocking additional data
        loadAdditionalData();

    } catch (err) {
        console.error('Init error:', err);
        showToast('à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­', 'error');
        setTimeout(showRealUI, 2000);
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI UPDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateProfileUI() {
    if (!state.user) return;
    DOM.profileName.textContent = state.user.displayName || 'à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰';
    DOM.profileEmail.textContent = state.user.email || '';
    DOM.profileAvatar.src = state.user.pictureUrl || 'https://via.placeholder.com/60/2a2e36/06c755?text=U';
    DOM.profileRole.textContent = ({ admin: 'ğŸ‘‘ à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸£à¸°à¸šà¸š', manager: 'ğŸ‘¥ à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£', user: 'ğŸ‘¤ à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸±à¹ˆà¸§à¹„à¸›' })[state.user.role] || '';

    DOM.adminOnly.forEach(el => el.classList.toggle('hidden', !state.isAdmin));
}

function showRealUI() {
    DOM.profileSkeleton.classList.add('hidden');
    DOM.profileReal.classList.remove('hidden');
    DOM.quickActionsSkeleton.classList.add('hidden');
    DOM.quickActionsReal.classList.remove('hidden');
    DOM.statsSkeleton.classList.add('hidden');
    DOM.statsReal.classList.remove('hidden');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROOMS RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRooms(rooms = state.rooms) {
    const q = DOM.searchInput.value.trim().toLowerCase();
    const filtered = q ? rooms.filter(r =>
        r.name?.toLowerCase().includes(q) ||
        r.location?.toLowerCase().includes(q) ||
        r.description?.toLowerCase().includes(q)
    ) : rooms;

    if (!filtered.length) {
        DOM.roomsList.innerHTML = `
            <div style="grid-column:1/-1;text-align:center;padding:48px 0;color:var(--text-secondary)">
                <i class="fas fa-door-open" style="font-size:36px;margin-bottom:12px;display:block"></i>
                <p>${q ? 'à¹„à¸¡à¹ˆà¸à¸šà¸«à¹‰à¸­à¸‡à¸—à¸µà¹ˆà¸„à¹‰à¸™à¸«à¸²' : 'à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡'}</p>
            </div>`;
        return;
    }

    DOM.roomsList.innerHTML = filtered.map(r => `
        <div class="room-card" onclick="showRoomDetail('${r.roomId}')">
            <div class="room-image">
                ${r.imageUrl
                    ? `<img src="${r.imageUrl}" alt="${r.name}" loading="lazy">`
                    : `<i class="fas fa-door-open" style="font-size:48px;color:var(--primary)"></i>`}
            </div>
            <div class="room-content">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                    <h3 style="font-weight:600;font-size:15px">${r.name}</h3>
                    <span style="background:rgba(6,199,85,.1);color:var(--primary);padding:4px 8px;border-radius:20px;font-size:12px;white-space:nowrap">
                        <i class="fas fa-users"></i> ${r.capacity}
                    </span>
                </div>
                <p style="color:var(--text-secondary);font-size:13px;margin-bottom:6px">
                    <i class="fas fa-map-marker-alt"></i> ${r.location || 'à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥'}
                </p>
                ${r.facilities ? `<p style="font-size:12px;color:var(--text-secondary)"><i class="fas fa-tv"></i> ${r.facilities}</p>` : ''}
            </div>
        </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOAD ADDITIONAL DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdditionalData() {
    if (!state.user?.lineUserId) return;
    const result = await callGAS('user/bookings', { lineUserId: state.user.lineUserId });
    if (result.success) {
        state.myBookings = result.data || [];
        updateBookingStats();
    }
}

function updateBookingStats() {
    const today = new Date().toISOString().split('T')[0];
    const todayCount = state.myBookings.filter(b => b.startTime?.startsWith(today) && b.status === 'confirmed').length;
    const pendingCount = state.myBookings.filter(b => b.status === 'pending').length;
    DOM.statToday.textContent = todayCount;
    DOM.statPending.textContent = pendingCount;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROOM DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.showRoomDetail = async function(roomId) {
    const modal = $id('modal-room-detail');
    const content = $id('room-detail-content');

    content.innerHTML = `<div style="text-align:center;padding:40px 0"><div class="spinner" style="width:32px;height:32px;border-width:3px;margin:0 auto"></div></div>`;
    modal.classList.remove('hidden');

    const result = await callGAS('room', { roomId });

    if (!result.success) {
        content.innerHTML = `<p style="color:var(--danger);text-align:center">à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ</p>`;
        return;
    }

    const r = result.data;
    content.innerHTML = `
        ${r.imageUrl ? `<img src="${r.imageUrl}" style="width:100%;max-height:220px;object-fit:cover;border-radius:14px;margin-bottom:16px">` : ''}
        <h3 style="font-size:20px;font-weight:700;margin-bottom:12px">${r.name}</h3>
        <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px">
            <p><i class="fas fa-users" style="color:var(--primary);width:20px"></i> à¸£à¸­à¸‡à¸£à¸±à¸š <b>${r.capacity}</b> à¸„à¸™</p>
            <p><i class="fas fa-map-marker-alt" style="color:var(--primary);width:20px"></i> ${r.location || 'à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥'}</p>
            ${r.description ? `<p><i class="fas fa-info-circle" style="color:var(--primary);width:20px"></i> ${r.description}</p>` : ''}
            ${r.facilities ? `<p><i class="fas fa-tv" style="color:var(--primary);width:20px"></i> ${r.facilities}</p>` : ''}
        </div>
        <div style="display:flex;gap:8px">
            <button onclick="closeModal('modal-room-detail');openBookingModal('${r.roomId}')" style="flex:1;padding:12px;background:var(--primary);color:#000;border:none;border-radius:12px;font-weight:700;cursor:pointer">
                <i class="fas fa-calendar-plus"></i> à¸ˆà¸­à¸‡à¸«à¹‰à¸­à¸‡à¸™à¸µà¹‰
            </button>
            ${state.isAdmin ? `<button onclick="closeModal('modal-room-detail');openEditRoomModal('${r.roomId}')" style="padding:12px;background:var(--bg);border:1px solid var(--border);color:var(--text);border-radius:12px;cursor:pointer"><i class="fas fa-edit"></i></button>` : ''}
        </div>`;
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOKING MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.openBookingModal = function(roomId = null) {
    // Populate room select
    const select = $id('bk-room');
    select.innerHTML = '<option value="">à¹€à¸¥à¸·à¸­à¸à¸«à¹‰à¸­à¸‡</option>' +
        state.rooms.map(r => `<option value="${r.roomId}">${r.name} (${r.capacity} à¸—à¸µà¹ˆà¸™à¸±à¹ˆà¸‡)</option>`).join('');

    if (roomId) select.value = roomId;

    // Default date = today
    $id('bk-date').value = new Date().toISOString().split('T')[0];
    $id('bk-title').value = '';
    $id('bk-note').value = '';
    $id('bk-attendees').value = '4';
    $id('bk-start').value = '09:00';
    $id('bk-end').value = '10:00';

    $id('modal-booking').classList.remove('hidden');
};

window.submitBooking = async function() {
    const roomId = $id('bk-room').value;
    const title = $id('bk-title').value.trim();
    const date = $id('bk-date').value;
    const start = $id('bk-start').value;
    const end = $id('bk-end').value;
    const attendees = $id('bk-attendees').value;
    const note = $id('bk-note').value.trim();

    if (!roomId || !title || !date || !start || !end) { showToast('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¸„à¸£à¸š', 'warning'); return; }

    const startDT = new Date(`${date}T${start}:00`);
    const endDT = new Date(`${date}T${end}:00`);

    if (startDT >= endDT) { showToast('à¹€à¸§à¸¥à¸²à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”à¸•à¹‰à¸­à¸‡à¸¡à¸²à¸à¸à¸§à¹ˆà¸²à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡', 'warning'); return; }
    if (startDT < new Date()) { showToast('à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸ˆà¸­à¸‡à¹€à¸§à¸¥à¸²à¹ƒà¸™à¸­à¸”à¸µà¸•à¹„à¸”à¹‰', 'warning'); return; }

    const btn = $id('bk-submit-btn');
    btn.disabled = true;
    btn.innerHTML = '<div class="spinner" style="width:18px;height:18px;border-width:2px;margin:0 auto"></div>';

    const result = await callGAS('booking/create', {
        roomId, title,
        startTime: startDT.toISOString(),
        endTime: endDT.toISOString(),
        attendees, note,
        userName: state.user.displayName,
        lineUserId: state.user.lineUserId
    });

    btn.disabled = false;
    btn.textContent = 'à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸ˆà¸­à¸‡';

    if (result.success) {
        showToast('à¸ˆà¸­à¸‡à¸«à¹‰à¸­à¸‡à¸›à¸£à¸°à¸Šà¸¸à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ! ğŸ‰', 'success');
        closeModal('modal-booking');
        await loadAdditionalData();
        if (state.currentTab === 'my') renderMyBookings();
    } else {
        showToast(result.message || 'à¸ˆà¸­à¸‡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¹‚à¸›à¸£à¸”à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ', 'error');
    }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MY BOOKINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMyBookings() {
    const list = $id('my-bookings-list');

    if (!state.myBookings.length) {
        list.innerHTML = `
            <div style="text-align:center;padding:48px 0;color:var(--text-secondary)">
                <i class="fas fa-calendar-times" style="font-size:36px;margin-bottom:12px;display:block"></i>
                <p>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¸ˆà¸­à¸‡</p>
                <button onclick="openBookingModal()" style="margin-top:12px;padding:10px 20px;background:var(--primary);color:#000;border:none;border-radius:10px;font-weight:600;cursor:pointer">
                    à¸ˆà¸­à¸‡à¸«à¹‰à¸­à¸‡à¹€à¸¥à¸¢
                </button>
            </div>`;
        return;
    }

    list.innerHTML = state.myBookings.map(b => {
        const start = b.startTime ? new Date(b.startTime) : null;
        const end = b.endTime ? new Date(b.endTime) : null;
        const dateStr = start ? start.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' }) : '-';
        const timeStr = start && end ? `${start.toTimeString().slice(0, 5)} - ${end.toTimeString().slice(0, 5)}` : '-';

        return `
        <div class="booking-card">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
                <h4 style="font-size:15px;font-weight:600;flex:1;margin-right:8px">${b.title || 'à¹„à¸¡à¹ˆà¸¡à¸µà¸Šà¸·à¹ˆà¸­'}</h4>
                <span class="status-badge status-${b.status}">${{ confirmed: 'à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´', pending: 'à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´', cancelled: 'à¸¢à¸à¹€à¸¥à¸´à¸' }[b.status] || b.status}</span>
            </div>
            <p style="font-size:13px;color:var(--text-secondary);margin-bottom:4px">
                <i class="fas fa-door-open" style="width:16px"></i> ${b.roomName || 'à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸šà¸«à¹‰à¸­à¸‡'}
            </p>
            <p style="font-size:13px;color:var(--text-secondary);margin-bottom:4px">
                <i class="fas fa-calendar" style="width:16px"></i> ${dateStr}
            </p>
            <p style="font-size:13px;color:var(--text-secondary)">
                <i class="fas fa-clock" style="width:16px"></i> ${timeStr}
            </p>
            ${b.status === 'confirmed' || b.status === 'pending' ? `
            <button onclick="cancelBooking('${b.bookingId}')" style="margin-top:10px;padding:6px 14px;background:none;border:1px solid var(--danger);border-radius:8px;color:var(--danger);cursor:pointer;font-size:12px">
                <i class="fas fa-times"></i> à¸¢à¸à¹€à¸¥à¸´à¸
            </button>` : ''}
        </div>`;
    }).join('');
}

window.cancelBooking = async function(bookingId) {
    if (!confirm('à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸ˆà¸­à¸‡à¸™à¸µà¹‰?')) return;
    const result = await callGAS('booking/cancel', { bookingId }, true);
    if (result.success) {
        showToast('à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸ˆà¸­à¸‡à¹à¸¥à¹‰à¸§', 'info');
        await loadAdditionalData();
        renderMyBookings();
    } else {
        showToast(result.message || 'à¸¢à¸à¹€à¸¥à¸´à¸à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'error');
    }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN â€” ROOMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.openAddRoomModal = function() {
    $id('add-room-title').textContent = 'à¹€à¸à¸´à¹ˆà¸¡à¸«à¹‰à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ';
    $id('room-edit-id').value = '';
    $id('room-name').value = '';
    $id('room-capacity').value = '10';
    $id('room-location').value = '';
    $id('room-description').value = '';
    $id('room-facilities').value = '';
    $id('room-image-file').value = '';
    $id('upload-preview').classList.add('hidden');
    $id('upload-placeholder').classList.remove('hidden');
    setUploadStatus('');
    setUploadProgress(0);
    state._pendingFile = null;
    state.uploadedImageUrl = '';
    $id('modal-add-room').classList.remove('hidden');
};

window.openEditRoomModal = async function(roomId) {
    const result = await callGAS('room', { roomId }, true);
    if (!result.success) { showToast('à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'error'); return; }
    const r = result.data;

    $id('add-room-title').textContent = 'à¹à¸à¹‰à¹„à¸‚à¸«à¹‰à¸­à¸‡';
    $id('room-edit-id').value = r.roomId;
    $id('room-name').value = r.name || '';
    $id('room-capacity').value = r.capacity || 10;
    $id('room-location').value = r.location || '';
    $id('room-description').value = r.description || '';
    $id('room-facilities').value = r.facilities || '';
    state.uploadedImageUrl = r.imageUrl || '';
    state._pendingFile = null;

    if (r.imageUrl) {
        $id('upload-preview').src = r.imageUrl;
        $id('upload-preview').classList.remove('hidden');
        $id('upload-placeholder').classList.add('hidden');
        setUploadStatus('à¸£à¸¹à¸›à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™');
    } else {
        $id('upload-preview').classList.add('hidden');
        $id('upload-placeholder').classList.remove('hidden');
        setUploadStatus('');
    }

    $id('modal-add-room').classList.remove('hidden');
};

window.submitRoom = async function() {
    const name = $id('room-name').value.trim();
    const capacity = $id('room-capacity').value;
    const location = $id('room-location').value.trim();
    const description = $id('room-description').value.trim();
    const facilities = $id('room-facilities').value.trim();
    const editId = $id('room-edit-id').value;

    if (!name || !capacity) { showToast('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¸«à¹‰à¸­à¸‡à¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸ˆà¸¸', 'warning'); return; }

    const btn = $id('room-submit-btn');
    btn.disabled = true;
    btn.innerHTML = '<div class="spinner" style="width:18px;height:18px;border-width:2px;margin:0 auto"></div>';

    let imageUrl = state.uploadedImageUrl;

    // à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¸£à¸¹à¸›à¸–à¹‰à¸²à¸¡à¸µà¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¸¡à¹ˆ
    if (state._pendingFile) {
        const url = await uploadImage(state._pendingFile);
        if (url) {
            imageUrl = url;
            state.uploadedImageUrl = url;
        }
        // à¸–à¹‰à¸²à¸­à¸±à¸›à¹‚à¸«à¸¥à¸”à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¹ƒà¸«à¹‰à¸¢à¸±à¸‡à¸„à¸‡à¹ƒà¸Šà¹‰ URL à¹€à¸à¹ˆà¸² (à¹„à¸¡à¹ˆ block)
    }

    const path = editId ? 'room/update' : 'room/create';
    const data = { name, capacity, location, description, facilities, imageUrl };
    if (editId) data.roomId = editId;

    const result = await callGAS(path, data);

    btn.disabled = false;
    btn.textContent = 'à¸šà¸±à¸™à¸—à¸¶à¸';

    if (result.success) {
        showToast(editId ? 'à¹à¸à¹‰à¹„à¸‚à¸«à¹‰à¸­à¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ' : 'à¹€à¸à¸´à¹ˆà¸¡à¸«à¹‰à¸­à¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'success');
        closeModal('modal-add-room');
        state._pendingFile = null;

        // Reload rooms
        const roomsResult = await callGAS('rooms', {});
        if (roomsResult.success) {
            state.rooms = roomsResult.data || [];
            renderRooms();
            DOM.statRooms.textContent = state.rooms.length;
            if (state.currentTab === 'admin') renderAdminRooms();
        }
    } else {
        showToast(result.message || 'à¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'error');
    }
};

function renderAdminRooms() {
    const el = $id('admin-rooms-list');
    if (!state.rooms.length) {
        el.innerHTML = '<p style="color:var(--text-secondary);text-align:center;padding:20px">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸«à¹‰à¸­à¸‡</p>';
        return;
    }

    el.innerHTML = `<div style="overflow-x:auto"><table class="admin-table">
        <thead><tr>
            <th>à¸Šà¸·à¹ˆà¸­à¸«à¹‰à¸­à¸‡</th>
            <th>à¸„à¸§à¸²à¸¡à¸ˆà¸¸</th>
            <th>à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡</th>
            <th>à¸ˆà¸±à¸”à¸à¸²à¸£</th>
        </tr></thead>
        <tbody>
        ${state.rooms.map(r => `
            <tr>
                <td>${r.name}</td>
                <td>${r.capacity} à¸„à¸™</td>
                <td>${r.location || '-'}</td>
                <td>
                    <button onclick="openEditRoomModal('${r.roomId}')" style="background:none;border:1px solid var(--border);border-radius:6px;padding:4px 10px;color:var(--text-secondary);cursor:pointer;font-size:12px;margin-right:4px">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deleteRoom('${r.roomId}','${r.name}')" style="background:none;border:1px solid var(--danger);border-radius:6px;padding:4px 10px;color:var(--danger);cursor:pointer;font-size:12px">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>`).join('')}
        </tbody>
    </table></div>`;
}

window.deleteRoom = async function(roomId, name) {
    if (!confirm(`à¸¥à¸šà¸«à¹‰à¸­à¸‡ "${name}" à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?`)) return;
    const result = await callGAS('room/delete', { roomId }, true);
    if (result.success) {
        showToast('à¸¥à¸šà¸«à¹‰à¸­à¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'info');
        state.rooms = state.rooms.filter(r => r.roomId !== roomId);
        renderRooms();
        renderAdminRooms();
    } else {
        showToast(result.message || 'à¸¥à¸šà¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'error');
    }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN â€” BOOKINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdminBookings() {
    const el = $id('admin-bookings-list');
    el.innerHTML = '<div class="skeleton" style="height:200px;border-radius:12px"></div>';

    const result = await callGAS('admin/bookings');
    if (!result.success) { el.innerHTML = '<p style="color:var(--danger);padding:20px;text-align:center">à¹‚à¸«à¸¥à¸”à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ</p>'; return; }

    const bookings = result.data || [];
    if (!bookings.length) { el.innerHTML = '<p style="color:var(--text-secondary);text-align:center;padding:20px">à¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¸ˆà¸­à¸‡</p>'; return; }

    el.innerHTML = `<div style="overflow-x:auto"><table class="admin-table">
        <thead><tr>
            <th>à¸œà¸¹à¹‰à¸ˆà¸­à¸‡</th><th>à¸«à¹‰à¸­à¸‡</th><th>à¸«à¸±à¸§à¸‚à¹‰à¸­</th><th>à¸§à¸±à¸™à¹€à¸§à¸¥à¸²</th><th>à¸ªà¸–à¸²à¸™à¸°</th><th>à¸ˆà¸±à¸”à¸à¸²à¸£</th>
        </tr></thead>
        <tbody>
        ${bookings.map(b => {
            const start = b.startTime ? new Date(b.startTime) : null;
            const timeStr = start ? `${start.toLocaleDateString('th-TH',{day:'numeric',month:'short'})} ${start.toTimeString().slice(0,5)}` : '-';
            return `<tr>
                <td>${b.userName || '-'}</td>
                <td>${b.roomName || '-'}</td>
                <td>${b.title || '-'}</td>
                <td style="white-space:nowrap">${timeStr}</td>
                <td><span class="status-badge status-${b.status}">${{confirmed:'à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´',pending:'à¸£à¸­',cancelled:'à¸¢à¸à¹€à¸¥à¸´à¸'}[b.status]||b.status}</span></td>
                <td>
                    ${b.status === 'pending' ? `
                    <button onclick="approveBooking('${b.bookingId}')" style="background:var(--primary);border:none;border-radius:6px;padding:4px 10px;color:#000;cursor:pointer;font-size:12px;margin-right:4px">à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´</button>
                    <button onclick="rejectBooking('${b.bookingId}')" style="background:none;border:1px solid var(--danger);border-radius:6px;padding:4px 10px;color:var(--danger);cursor:pointer;font-size:12px">à¸›à¸à¸´à¹€à¸ªà¸˜</button>
                    ` : '-'}
                </td>
            </tr>`;
        }).join('')}
        </tbody>
    </table></div>`;
}

window.approveBooking = async function(bookingId) {
    const result = await callGAS('admin/booking/approve', { bookingId }, true);
    if (result.success) { showToast('à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'success'); loadAdminBookings(); }
    else showToast(result.message || 'à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'error');
};
window.rejectBooking = async function(bookingId) {
    if (!confirm('à¸›à¸à¸´à¹€à¸ªà¸˜à¸à¸²à¸£à¸ˆà¸­à¸‡à¸™à¸µà¹‰?')) return;
    const result = await callGAS('admin/booking/reject', { bookingId }, true);
    if (result.success) { showToast('à¸›à¸à¸´à¹€à¸ªà¸˜à¹à¸¥à¹‰à¸§', 'info'); loadAdminBookings(); }
    else showToast(result.message || 'à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ', 'error');
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.closeModal = function(id) { $id(id).classList.add('hidden'); };

// Close on backdrop click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
    overlay.addEventListener('click', e => {
        if (e.target === overlay) overlay.classList.add('hidden');
    });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB SWITCHING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(tab) {
    state.currentTab = tab;
    DOM.navItems.forEach(i => i.classList.remove('active'));
    document.querySelectorAll(`[data-tab="${tab}"]`).forEach(i => i.classList.add('active'));

    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    $id(`page-${tab}`)?.classList.add('active');

    if (tab === 'my') { loadAdditionalData().then(renderMyBookings); }
    if (tab === 'admin') { renderAdminRooms(); loadAdminBookings(); }
}

DOM.navItems.forEach(item => item.addEventListener('click', () => switchTab(item.dataset.tab)));
$id('nav-home').addEventListener('click', () => switchTab('home'));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEARCH (debounced)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let searchTimer;
DOM.searchInput.addEventListener('input', () => {
    clearTimeout(searchTimer);
    searchTimer = setTimeout(() => renderRooms(), 250);
});

// Quick action buttons
$id('btn-quick-book').addEventListener('click', () => openBookingModal());
$id('btn-today').addEventListener('click', () => {
    switchTab('my');
});
$id('btn-all-rooms').addEventListener('click', () => {
    DOM.searchInput.value = '';
    renderRooms();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETUP & START
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
setupUploadZone();
init();
</script>
</body>
</html>
