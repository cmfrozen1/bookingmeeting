<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title id="page-title">Meeting Room · LINE</title>
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/1040/1040244.png">
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- LINE LIFF -->
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
    
    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" media="print" onload="this.media='all'">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/th.js" defer></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Initial Loading -->
    <div class="initial-loading" id="initial-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text mt-4 text-[#06c755]">กำลังโหลด...</div>
    </div>
    
    <!-- Floating Book Button -->
    <div id="floating-book-btn" class="floating-book-btn hidden" onclick="showBookingModal()">
        <i class="fas fa-calendar-plus text-2xl"></i>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="navbar-logo" onclick="window.location.href='index.html'">
                <i class="fas fa-door-open"></i>
                <span id="navbar-app-name">Meeting Room</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <!-- Profile Header -->
        <div class="profile-header" id="profile-header">
            <img id="profile-avatar" src="https://via.placeholder.com/60/2a2e36/06c755?text=..." alt="avatar" class="profile-avatar">
            <div class="flex-1">
                <h2 id="profile-name" class="text-lg font-bold">กำลังโหลด...</h2>
                <p id="profile-email" class="text-sm text-gray-400"></p>
                <p id="profile-role" class="text-xs text-[#06c755] mt-1"></p>
            </div>
            <i class="fas fa-chevron-down text-gray-400"></i>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="quick-action-btn" onclick="showBookingModal()">
                <div class="quick-action-icon"><i class="fas fa-calendar-plus"></i></div>
                <div class="quick-action-label">จองด่วน</div>
            </div>
            <div class="quick-action-btn" onclick="goToToday()">
                <div class="quick-action-icon"><i class="fas fa-calendar-day"></i></div>
                <div class="quick-action-label">วันนี้</div>
            </div>
            <div class="quick-action-btn" onclick="showAllRooms()">
                <div class="quick-action-icon"><i class="fas fa-door-open"></i></div>
                <div class="quick-action-label">ห้องว่าง</div>
            </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-3 gap-2 max-w-7xl mx-auto px-4 mb-4">
            <div class="stat-card">
                <p class="text-xs text-gray-400">ห้องทั้งหมด</p>
                <p id="stat-rooms" class="text-xl font-bold text-[#06c755]">0</p>
            </div>
            <div class="stat-card">
                <p class="text-xs text-gray-400">จองวันนี้</p>
                <p id="stat-today" class="text-xl font-bold text-[#06c755]">0</p>
            </div>
            <div class="stat-card">
                <p class="text-xs text-gray-400">รออนุมัติ</p>
                <p id="stat-pending" class="text-xl font-bold text-yellow-500">0</p>
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="calendar-container">
            <div class="calendar-header">
                <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="calendar-month" id="current-month">กำลังโหลด...</span>
                <button class="calendar-nav-btn" onclick="changeMonth(1)">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <div class="calendar-weekdays">
                <div>อา</div>
                <div>จ</div>
                <div>อ</div>
                <div>พ</div>
                <div>พฤ</div>
                <div>ศ</div>
                <div>ส</div>
            </div>
            
            <div class="calendar-days" id="calendar-days">
                <!-- Skeleton จะถูกสร้างโดย JavaScript -->
            </div>
            
            <!-- Selected Date Bookings -->
            <div id="selected-date-bookings" class="date-bookings-list hidden">
                <h3 class="text-sm font-semibold mb-2" id="selected-date-title"></h3>
                <div id="selected-date-bookings-list"></div>
            </div>
        </div>

        <!-- Search -->
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" placeholder="ค้นหาห้องประชุม..." autocomplete="off">
        </div>

        <!-- Rooms List -->
        <div id="rooms-list" class="rooms-grid">
            <!-- Skeleton จะถูกสร้างโดย JavaScript -->
        </div>
    </main>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" data-page="index.html">
            <i class="fas fa-door-open"></i>
            <span>ห้องประชุม</span>
        </div>
        <div class="nav-item" data-page="my-bookings.html">
            <i class="fas fa-calendar-check"></i>
            <span>การจองของฉัน</span>
        </div>
        <div class="nav-item hidden admin-only" data-page="admin.html">
            <i class="fas fa-cog"></i>
            <span>จัดการ</span>
        </div>
    </div>

    <!-- Modals (imported) -->
    <div id="modals-container"></div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/index.js" data-page="index"></script>
    
    <script>
        // โหลด modals
        fetch('shared/modals.html')
            .then(res => res.text())
            .then(html => {
                document.getElementById('modals-container').innerHTML = html;
            });
        
        // จัดการ navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                if (page) window.location.href = page;
            });
        });
        
        // จัดการโปรไฟล์
        document.getElementById('profile-header').addEventListener('click', () => {
            Swal.fire({
                title: window.state.user?.displayName,
                text: window.state.user?.email,
                showCancelButton: true,
                confirmButtonText: 'แก้ไขโปรไฟล์',
                cancelButtonText: 'ออกจากระบบ'
            }).then(r => {
                if (r.isConfirmed) showProfileSettings();
                else if (r.dismiss === Swal.DismissReason.cancel) logout();
            });
        });
    </script>
</body>
</html>
