<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>การจองของฉัน · Meeting Room</title>
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/1040/1040244.png">
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- LINE LIFF -->
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Initial Loading -->
    <div class="initial-loading" id="initial-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text mt-4 text-[#06c755]">กำลังโหลด...</div>
    </div>
    
    <!-- Floating Book Button -->
    <div id="floating-book-btn" class="floating-book-btn hidden" onclick="window.location.href='index.html?action=book'">
        <i class="fas fa-calendar-plus text-2xl"></i>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="navbar-logo" onclick="window.location.href='index.html'">
                <i class="fas fa-door-open"></i>
                <span id="navbar-app-name">Meeting Room</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <!-- Profile Header -->
        <div class="profile-header" id="profile-header">
            <img id="profile-avatar" src="https://via.placeholder.com/60/2a2e36/06c755?text=..." alt="avatar" class="profile-avatar">
            <div class="flex-1">
                <h2 id="profile-name" class="text-lg font-bold">กำลังโหลด...</h2>
                <p id="profile-email" class="text-sm text-gray-400"></p>
                <p id="profile-role" class="text-xs text-[#06c755] mt-1"></p>
            </div>
            <i class="fas fa-chevron-down text-gray-400"></i>
        </div>

        <!-- Page Title -->
        <div class="flex justify-between items-center max-w-7xl mx-auto px-4 mb-4">
            <h2 class="text-xl font-bold text-[#06c755]">การจองของฉัน</h2>
            <button id="quick-book-btn" class="bg-[#06c755] text-white px-4 py-2 rounded-xl text-sm hidden" onclick="window.location.href='index.html?action=book'">
                <i class="fas fa-plus mr-1"></i>จองด่วน
            </button>
        </div>
        
        <!-- Filter tabs -->
        <div class="filter-container">
            <button class="filter-btn active" data-booking-filter="all">ทั้งหมด</button>
            <button class="filter-btn" data-booking-filter="confirmed">อนุมัติแล้ว</button>
            <button class="filter-btn" data-booking-filter="pending">รออนุมัติ</button>
            <button class="filter-btn" data-booking-filter="cancelled">ยกเลิก</button>
            <button class="filter-btn" data-booking-filter="rejected">ปฏิเสธ</button>
        </div>
        
        <!-- Bookings List -->
        <div id="my-bookings-list" class="my-bookings-grid">
            <!-- Skeleton -->
            <div class="skeleton-card"></div>
            <div class="skeleton-card"></div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item" data-page="index.html">
            <i class="fas fa-door-open"></i>
            <span>ห้องประชุม</span>
        </div>
        <div class="nav-item active" data-page="my-bookings.html">
            <i class="fas fa-calendar-check"></i>
            <span>การจองของฉัน</span>
        </div>
        <div class="nav-item hidden admin-only" data-page="admin.html">
            <i class="fas fa-cog"></i>
            <span>จัดการ</span>
        </div>
    </div>

    <!-- Modals (imported) -->
    <div id="modals-container"></div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/my-bookings.js" data-page="my-bookings"></script>
    
    <script>
        // โหลด modals
        fetch('shared/modals.html')
            .then(res => res.text())
            .then(html => {
                document.getElementById('modals-container').innerHTML = html;
            });
        
        // จัดการ navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                if (page) window.location.href = page;
            });
        });
        
        // จัดการโปรไฟล์
        document.getElementById('profile-header').addEventListener('click', () => {
            Swal.fire({
                title: window.state.user?.displayName,
                text: window.state.user?.email,
                showCancelButton: true,
                confirmButtonText: 'แก้ไขโปรไฟล์',
                cancelButtonText: 'ออกจากระบบ'
            }).then(r => {
                if (r.isConfirmed) showProfileSettings();
                else if (r.dismiss === Swal.DismissReason.cancel) logout();
            });
        });
    </script>
</body>
</html>
